```markdown

# 1 术语和缩略语
- **SDLC**：软件开发生命周期
- **API**：应用程序编程接口

# 2 需求概述
建设食堂物资管理系统，实现菜单管理、成本核算、订餐集成、物资出入库管理及经营数据分析，支撑食堂高效运营。系统角色包括**学校管理员**（基础数据维护、监管、报表查看）和**服务公司**（日常经营维护）。

# 3 系统功能需求


## 3.1 用户角色与权限
| 角色         | 权限                         | 操作范围                     |
|--------------|------------------------------|------------------------------|
| 学校管理员   | 基础数据维护、数据查询统计   | 全系统数据                   |
| 服务公司     | 日常经营数据录入、库房管理   | 所属公司数据                 |

## 3.2 核心功能模块


### 3.2.1 基础数据管理(Priority:1,Effort:15)
学校管理员专属模块，维护系统核心主数据。

####  子功能列表
1. **物资管理**  
   - 支持多级分类（蔬菜类/粮油类等）
   - 字段：物资编码、名称、计量单位、规格型号、图片、品牌
2. **供应商管理**  
   - 字段：供应商编码、名称、社会信用代码、食品安全认证、联系人、状态(启用/禁用)
3. **服务公司管理**  
   - 字段：公司编码、名称、社会信用代码、食品安全认证、联系人、状态(启用/禁用)
4. **基础菜单管理**  
   - 字段：菜单编号、名称、类型(早/中/晚)、图片、配餐材料清单  
   - 配餐材料字段：物资编码、名称、单位、数量、成本单价

### 3.2.2 经营管理(Priority:1,Effort:20)
服务公司操作模块，学校管理员仅可查看。

####  子功能列表
1. **库房管理**  
   - 字段：库房编码、名称、所属公司
2. **每日菜单管理**  
   - 从基础菜单选择，字段：菜单日期、类别、菜单编码、名称、图片、配料
3. **出入库管理**  
   - 主表字段：出入库编码、日期、库房、经手人、供应商、金额  
   - 明细表字段：物资编码、名称、规格、单位、单价、数量、金额  
   - 支持整入整出、数据锁定
4. **盘库管理**  
   - 支持盘库入库/出库操作
5. **供应商结算**  
   - 基于入库单（总金额、已结金额）结算
6. **经营数据管理**  
   - 订餐人数（API获取或手动录入）
   - 经营成本：水电费、工资、房租等
   - 日偏差数据自动计算（例：计划消耗 vs 实际消耗）

# 4 数据库表设计
| 表名             | 中文名       | 说明                     | 主要字段                                                                 |
|------------------|--------------|--------------------------|--------------------------------------------------------------------------|
| `material`       | 物资主数据   | 食材基础信息             | 物资编码(PK), 分类, 名称, 单位, 规格, 图片, 品牌                         |
| `supplier`       | 供应商       | 食材供应商               | 供应商编码(PK), 名称, 社会信用代码, 食品安全认证, 联系人, 状态          |
| `service_company`| 服务公司     | 食堂经营单位             | 公司编码(PK), 名称, 社会信用代码, 食品安全认证, 联系人, 状态            |
| `base_menu`      | 基础菜单     | 固定菜单模板             | 菜单编号(PK), 名称, 类型, 图片                                          |
| `menu_material`  | 菜单配料明细 | 菜单与物资关联表         | 菜单编号(FK), 物资编码(FK), 数量, 成本单价                              |
| `warehouse`      | 库房         | 服务公司库房             | 库房编码(PK), 名称, 所属公司(FK)                                        |
| `daily_menu`     | 每日菜单     | 服务公司每日执行菜单     | 菜单日期+公司编码(PK), 基础菜单编号(FK)                                 |
| `in_out_main`    | 出入库主表   | 出入库单据头             | 单据编码(PK), 日期, 类型(入/出), 库房(FK), 供应商(FK), 总金额, 锁定状态 |
| `in_out_detail`  | 出入库明细   | 单据明细                 | 单据编码(FK), 物资编码(FK), 单价, 数量, 金额                            |
| `inventory`      | 库存表       | 实时物资库存             | 公司编码(FK)+库房(FK)+物资编码(FK), 当前数量                            |

# 5 接口设计


## 5.1 依赖的REST服务接口
| 服务对象名       | 说明                     |
|------------------|--------------------------|
| 第三方订餐系统   | 获取每日菜品订餐人数数据 |

## 5.2 提供的REST服务接口
| 服务对象名       | 说明                     |
|------------------|--------------------------|
| 经营报表系统     | 提供出入库/库存查询接口  |
| 财务系统         | 提供供应商结算数据接口   |

# 6 非功能需求


## 6.1 性能需求
- 物资库存数据实时更新（延迟 ≤ 3秒）
- 统计报表生成响应时间 ≤ 5秒（万级数据量）

## 6.2 安全需求
- 敏感字段（社会信用代码、金额）加密存储
- 禁用状态的服务公司账号禁止登录

## 6.3 合规需求
- 供应商/服务公司食品安全认证信息需留档
- 入库票据附件保留周期 ≥ 3年

## 6.4 其他需求
- 支持物资图片上传与预览（格式：JPG/PNG）

# 7 原始需求中的额外要求
1. **状态控制逻辑**  
   - 禁用的供应商不出现在入库选择列表，但保留历史数据
   - 禁用的服务公司禁止登录，保留历史数据
2. **数据锁定机制**  
   - 已锁定的出入库数据禁止编辑/删除
3. **菜单时效性**  
   - 已结算日期的每日菜单禁止修改
4. **库存可见性**  
   - 出入库操作时可查看实时库存
5. **偏差计算依据**  
   - 日偏差数据基于出库单与计划消耗量自动计算（示例：计划200kg牛肉 vs 实际消耗）
```

