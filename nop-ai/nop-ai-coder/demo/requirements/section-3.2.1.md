#  基础数据管理


##  用户故事列表


###  US-3.2.1-001:物资分类管理(Priority:1,Effort:2)
- Who: 学校管理员
- What: 需要维护物资的多级分类体系（如蔬菜类/粮油类等）
- Why: 确保物资能够按照标准分类体系进行管理
- 关联用例: UC-3.2.1-001

###  US-3.2.1-002:物资基础信息维护(Priority:1,Effort:3)
- Who: 学校管理员
- What: 需要维护物资的基础信息（编码、名称、单位等）
- Why: 确保系统所有物资信息完整准确
- 关联用例: UC-3.2.1-002

###  US-3.2.1-003:供应商生命周期管理(Priority:1,Effort:2)
- Who: 学校管理员
- What: 需要管理供应商的启用/禁用状态
- Why: 确保只有合规供应商才能参与业务
- 关联用例: UC-3.2.1-003

###  US-3.2.1-004:服务公司生命周期管理(Priority:1,Effort:2)
- Who: 学校管理员
- What: 需要管理服务公司的启用/禁用状态
- Why: 确保只有合规服务公司才能运营食堂
- 关联用例: UC-3.2.1-004

###  US-3.2.1-005:基础菜单模板管理(Priority:2,Effort:3)
- Who: 学校管理员
- What: 需要维护基础菜单模板及其配料清单
- Why: 为每日菜单提供标准化模板
- 关联用例: UC-3.2.1-005

##  用例列表


###  UC-3.2.1-001:物资分类管理(useCaseType:ui)


####  基本信息
- **菜单路径**：基础数据管理/物资管理/分类设置
- **参与者**：学校管理员（主要）、服务公司（次要，仅查看）
- **触发条件**：管理员需要调整物资分类体系
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 用户已登录且具有管理员权限

**基本流程**：
1. 用户进入分类管理界面 [涉及UI：PAGE-3.2.1-001]
2. 系统展示现有分类树形结构 [涉及API：material/category/getTree]
3. 用户选择添加/编辑/删除分类操作
4. 系统验证操作合法性并保存 [涉及API：material/category/save]
5. 系统返回操作结果

**异常流程**：
- 分支1：删除非空分类 → 提示"该分类下存在物资，无法删除"
- 分支2：分类名称重复 → 提示"同级分类名称不能重复"

**后置条件**：
- 数据变更：material表分类字段关联关系更新

###  UC-3.2.1-002:物资基础信息维护(useCaseType:ui)


####  基本信息
- **菜单路径**：基础数据管理/物资管理
- **参与者**：学校管理员（主要）
- **触发条件**：需要新增或修改物资信息
- **使用频率**：中频

####  详细说明
[标准CRUD流程]

###  UC-3.2.1-003:供应商状态管理(useCaseType:ui)


####  基本信息
- **菜单路径**：基础数据管理/供应商管理
- **参与者**：学校管理员（主要）
- **触发条件**：需要启用/禁用供应商
- **使用频率**：低频

####  详细说明
**前置条件**：
1. 供应商记录已存在

**基本流程**：
1. 用户在供应商列表选择目标记录 [涉及UI：PAGE-3.2.1-003]
2. 点击"状态切换"按钮
3. 系统弹出确认对话框
4. 用户确认操作
5. 系统更新状态并同步业务限制 [涉及API：supplier/updateStatus]
6. 刷新列表显示最新状态

**异常流程**：
- 分支1：供应商存在未完成订单 → 提示"该供应商存在未完成业务，请处理后再禁用"

**后置条件**：
- 数据变更：supplier表状态字段更新

###  UC-3.2.1-004:服务公司状态管理(useCaseType:ui)


####  基本信息
- **菜单路径**：基础数据管理/服务公司管理
- **参与者**：学校管理员（主要）
- **触发条件**：需要启用/禁用服务公司
- **使用频率**：低频

####  详细说明
[标准CRUD流程]

###  UC-3.2.1-005:基础菜单模板维护(useCaseType:ui)


####  基本信息
- **菜单路径**：基础数据管理/基础菜单管理
- **参与者**：学校管理员（主要）
- **触发条件**：需要调整菜单模板
- **使用频率**：中频

####  详细说明
**前置条件**：
1. 相关物资数据已维护

**基本流程**：
1. 用户进入菜单管理界面 [涉及UI：PAGE-3.2.1-005]
2. 系统加载现有菜单列表 [涉及API：baseMenu/list]
3. 用户选择添加/编辑操作
4. 系统展示菜单编辑表单
5. 用户维护主信息并添加配料 [涉及UI：配料表格编辑区]
6. 用户提交保存
7. 系统验证并保存数据 [涉及API：baseMenu/save]
8. 返回操作结果

**异常流程**：
- 分支1：配料数量为空 → 提示"配料数量必须大于0"
- 分支2：重复配料 → 提示"同一物资不能重复添加"

**后置条件**：
- 数据变更：base_menu和menu_material表相关记录更新

##  页面列表


###  PAGE-3.2.1-001:物资分类管理(pageType:tabs)
**基本信息**：
- 菜单ID：material_category
- 关联用例：UC-3.2.1-001

**功能模块**：
| 区域 | 组件 | 字段列表 | 行为 |
|------|------|---------|------|
| 左侧 | 树形组件 | 分类ID, 分类名称, 层级 | 支持拖拽排序 |
| 右侧 | 表单 | 父级分类, 分类名称, 分类编码 | 提交验证名称唯一性 |
| 顶部 | 操作栏 | 新增, 编辑, 删除 | 根据选中节点启用 |

**状态说明**：
- 初始状态：加载顶层分类
- 交互状态：右键节点显示上下文菜单
- 错误状态：拖拽非法位置时显示红色警示

###  PAGE-3.2.1-002:物资管理(pageType:list)
**基本信息**：
- 菜单ID：material_manage
- 关联用例：UC-3.2.1-002

**功能模块**：
| 区域 | 组件 | 字段列表 | 行为 |
|------|------|---------|------|
| 头部 | 搜索框 | 物资编码, 名称, 分类 | 支持模糊查询 |
| 主体 | 数据表格 | 物资编码, 名称, 单位, 规格, 品牌 | 支持分页和导出 |
| 浮动 | 编辑表单 | 所有物资字段+图片上传 | 表单验证 |

###  PAGE-3.2.1-003:供应商管理(pageType:list)
**基本信息**：
- 菜单ID：supplier_manage
- 关联用例：UC-3.2.1-003

**功能模块**：
| 区域 | 组件 | 字段列表 | 行为 |
|------|------|---------|------|
| 头部 | 状态筛选 | 启用/禁用开关 | AJAX实时过滤 |
| 主体 | 数据表格 | 供应商编码, 名称, 状态, 联系人 | 行内状态切换按钮 |
| 底部 | 批量操作 | 导出, 批量启用/禁用 | 需二次确认 |

###  PAGE-3.2.1-005:基础菜单管理(pageType:detail)
**基本信息**：
- 菜单ID：base_menu_manage
- 关联用例：UC-3.2.1-005

**功能模块**：
| 区域 | 组件 | 字段列表 | 行为 |
|------|------|---------|------|
| 头部 | 基本信息 | 菜单编号, 名称, 类型, 图片 | 图片预览功能 |
| 主体 | 配料表格 | 物资选择器, 数量, 单价 | 支持行内计算 |
| 底部 | 成本汇总 | 总成本金额 | 自动计算 |

##  业务规则
**数据规则**：
- 物资编码：必须符合^[A-Z]{2}\d{6}$格式
- 社会信用代码：必须18位且符合校验规则
- 食品安全认证：必须上传有效期内的证书扫描件

**状态机规则**：
| 当前状态 | 允许操作 | 目标状态 | 条件 |
|----------|----------|----------|------|
| 启用 | 禁用 | 禁用 | 无未完成订单 |
| 禁用 | 启用 | 启用 | 证书在有效期内 |

**计算规则**：
- 菜单总成本：SUM(配料数量*成本单价)
- 库存警戒值：日均消耗量*3

##  安全需求
敏感字段：
- 社会信用代码
- 联系人手机号

审计要求：
- 供应商状态变更
- 服务公司状态变更
- 物资分类结构调整

##  待确认的问题
1. 物资分类是否需要有最大层级限制？
2. 禁用服务公司时，是否需要对关联数据进行特殊处理？

##  数据库设计补充
**修改表**:
| 表名 | 中文名 | 说明 | 修改描述 |
|------|--------|------|----------|
| material | 物资主数据 | 增加分类约束 | 增加category_path字段存储分类路径 |
| supplier | 供应商 | 增加审计字段 | 增加status_change_time和operator字段 |
| base_menu | 基础菜单 | 增加成本字段 | 增加total_cost字段自动计算 |

**其他设计改进**:
1. material表分类字段需要建立外键约束
2. supplier/service_company表状态字段应设置默认值(1-启用)
3. menu_material表需要增加唯一约束(菜单编号+物资编码)

